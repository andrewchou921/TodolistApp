import{r as d,u as N,i as D,h as v,j as w,c as i,a as t,t as m,w as r,b as y,v as L,n as $,F as b,k as K,l as x,o as u,m as O,p as P}from"./index-CM1uWy1J.js";const F={id:"todoListPage",class:"bg-half"},I=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1),j={class:"todo_sm"},q={href:"#"},J={class:"container todoListPage vhContainer"},R={class:"todoList_Content"},G={class:"inputBox"},H=t("i",{class:"fa fa-plus"},null,-1),Q=[H],W={class:"todoList_list"},X={class:"todoList_tab"},Y={class:"todoList_items"},Z={class:"todoList_item"},tt={key:0},et=["onKeyup"],ot=["onClick"],nt={class:"todoList_label"},st=["onUpdate:modelValue","onChange"],at=["onClick"],lt=t("i",{class:"fa-solid fa-pen-to-square fa-lg"},null,-1),it=[lt],rt=["onClick"],ut=t("i",{class:"fa-solid fa-trash-can fa-lg"},null,-1),ct=[ut],dt={class:"todoList_statistics"},vt={key:0},ht={key:1},h="https://todolist-api.hexschool.io",ft={__name:"TodoListView",setup(_t){const s=d({nickname:"",uid:"",token:""}),C=N();D(async()=>{const e=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");if(e)try{const o=await v.get(`${h}/users/checkout`,{headers:{Authorization:e}});s.value=o.data,s.value.token=e,console.log("登入成功:",s.value),f()}catch(o){console.error("用戶驗證失敗:",o),document.cookie="customTodoToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",C.push("/login")}else window.location.href="/login"});async function z(){try{s.value={nickname:"",uid:"",token:""},alert("您已登出"),C.push("/login")}catch(e){console.error("登出失敗:",e)}}const l=d([]),k=d(""),c=d("all"),_=d(null),p=d(""),V=w(()=>c.value==="todo"?l.value.filter(e=>!e.status):c.value==="done"?l.value.filter(e=>e.status):l.value),A=w(()=>l.value.filter(e=>!e.status).length),g=e=>{c.value=e};async function f(){try{const{data:e}=await v.get(`${h}/todos`,{headers:{Authorization:`${s.value.token}`}});l.value=e.data}catch(e){console.error("取得待辦事項失敗:",e)}}async function E(){var e;try{const o=k.value.trim();if(o.length===0)return alert("Todo內容不能為空白");if(!s.value.token)return alert("未獲得授權，請重新登入");await v.post(`${h}/todos`,{content:o},{headers:{Authorization:` ${s.value.token}`}}),k.value="",f()}catch(o){console.error("新增待辦事項失敗:",((e=o.response)==null?void 0:e.data)||o.message),alert("新增待辦事項失敗，請檢查輸入內容或重新登入")}}async function B(e){try{await v.patch(`${h}/todos/${e.id}/toggle`,{},{headers:{Authorization:`${s.value.token}`}}),f()}catch(o){console.error("切換狀態失敗:",o)}}async function S(e){try{await v.delete(`${h}/todos/${e.id}`,{headers:{Authorization:`${s.value.token}`}}),f()}catch(o){console.error("刪除待辦事項失敗:",o)}}function U(e){_.value=e,p.value=e.content}async function T(e){try{if(e.content===p.value){_.value=null;return}await v.put(`${h}/todos/${e.id}`,{content:p.value},{headers:{Authorization:`${s.value.token}`}}),_.value=null,f()}catch(o){console.error("保存編輯失敗:",o)}}function M(e){return _.value&&_.value.id===e.id}return(e,o)=>(u(),i("div",F,[t("nav",null,[I,t("ul",null,[t("li",j,[t("a",q,[t("span",null,m(s.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{href:"#loginPage",onClick:r(z,["prevent"])},"登出")])])]),t("div",J,[t("div",R,[t("div",G,[y(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":o[0]||(o[0]=n=>k.value=n)},null,512),[[L,k.value]]),t("a",{href:"#",onClick:r(E,["prevent"])},Q)]),t("div",W,[t("ul",X,[t("li",null,[t("a",{href:"#",class:$({active:c.value==="all"}),onClick:o[1]||(o[1]=r(n=>g("all"),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:$({active:c.value==="todo"}),onClick:o[2]||(o[2]=r(n=>g("todo"),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:$({active:c.value==="done"}),onClick:o[3]||(o[3]=r(n=>g("done"),["prevent"]))},"已完成",2)])]),t("div",Y,[t("ul",Z,[(u(!0),i(b,null,K(V.value,n=>(u(),i("li",{key:n.id},[M(n)?(u(),i("div",tt,[y(t("input",{class:"inputBox","onUpdate:modelValue":o[4]||(o[4]=a=>p.value=a),onKeyup:O(a=>T(n),["enter"])},null,40,et),[[L,p.value]]),t("button",{onClick:a=>T(n),class:"formControls_btnSubmit"},"保存",8,ot),t("button",{onClick:o[5]||(o[5]=(...a)=>e.cancelEdit&&e.cancelEdit(...a))},"取消")])):(u(),i(b,{key:1},[t("label",nt,[y(t("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":a=>n.status=a,onChange:a=>B(n)},null,40,st),[[P,n.status]]),t("span",null,m(n.content),1)]),t("a",{href:"#",onClick:r(a=>U(n),["prevent"])},it,8,at),t("a",{href:"#",onClick:r(a=>S(n),["prevent"])},ct,8,rt)],64))]))),128))]),t("div",dt,[l.value.length===0?(u(),i("p",vt,"目前尚無待辦事項")):x("",!0),l.value.length>0?(u(),i("p",ht,m(A.value)+" 個未完成項目",1)):x("",!0)])])])])])]))}};export{ft as default};
