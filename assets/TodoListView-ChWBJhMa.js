import{r as i,u as V,i as A,h as c,j as T,c as u,a as t,t as k,w as r,b as $,v as B,n as g,F as M,k as N,l as y,o as d,m as U}from"./index-BfGp092e.js";const D={id:"todoListPage",class:"bg-half"},O=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1),P={class:"todo_sm"},S={href:"#"},E={class:"container todoListPage vhContainer"},F={class:"todoList_Content"},I={class:"inputBox"},j=t("i",{class:"fa fa-plus"},null,-1),J=[j],R={class:"todoList_list"},q={class:"todoList_tab"},G={class:"todoList_items"},H={class:"todoList_item"},K={class:"todoList_label"},Q=["onUpdate:modelValue","onChange"],W=["onClick"],X=t("i",{class:"fa-solid fa-trash-can fa-lg"},null,-1),Y=[X],Z={class:"todoList_statistics"},tt={key:0},et={key:1},h="https://todolist-api.hexschool.io",nt={__name:"TodoListView",setup(ot){const n=i({nickname:"",uid:"",token:""}),m=V();A(async()=>{const e=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");if(e)try{const o=await c.get(`${h}/users/checkout`,{headers:{Authorization:e}});n.value=o.data,n.value.token=e,console.log("登入成功:",n.value),_()}catch(o){console.error("用戶驗證失敗:",o),document.cookie="customTodoToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",m.push("/login")}else window.location.href="/login"});async function C(){try{n.value={nickname:"",uid:"",token:""},alert("您已登出"),m.push("/login")}catch(e){console.error("登出失敗:",e)}}const a=i([]),v=i(""),l=i("all");i(null),i("");const L=T(()=>l.value==="todo"?a.value.filter(e=>!e.status):l.value==="done"?a.value.filter(e=>e.status):a.value),w=T(()=>a.value.filter(e=>!e.status).length),p=e=>{l.value=e};async function _(){try{const{data:e}=await c.get(`${h}/todos`,{headers:{Authorization:`${n.value.token}`}});a.value=e.data}catch(e){console.error("取得待辦事項失敗:",e)}}async function x(){var e;try{const o=v.value.trim();if(o.length===0)return alert("Todo內容不能為空白");if(!n.value.token)return alert("未獲得授權，請重新登入");await c.post(`${h}/todos`,{content:o},{headers:{Authorization:` ${n.value.token}`}}),v.value="",_()}catch(o){console.error("新增待辦事項失敗:",((e=o.response)==null?void 0:e.data)||o.message),alert("新增待辦事項失敗，請檢查輸入內容或重新登入")}}async function b(e){try{await c.patch(`${h}/todos/${e.id}/toggle`,{},{headers:{Authorization:`${n.value.token}`}}),_()}catch(o){console.error("切換狀態失敗:",o)}}async function z(e){try{await c.delete(`${h}/todos/${e.id}`,{headers:{Authorization:`${n.value.token}`}}),_()}catch(o){console.error("刪除待辦事項失敗:",o)}}return(e,o)=>(d(),u("div",D,[t("nav",null,[O,t("ul",null,[t("li",P,[t("a",S,[t("span",null,k(n.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{href:"#loginPage",onClick:r(C,["prevent"])},"登出")])])]),t("div",E,[t("div",F,[t("div",I,[$(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":o[0]||(o[0]=s=>v.value=s)},null,512),[[B,v.value]]),t("a",{href:"#",onClick:r(x,["prevent"])},J)]),t("div",R,[t("ul",q,[t("li",null,[t("a",{href:"#",class:g({active:l.value==="all"}),onClick:o[1]||(o[1]=r(s=>p("all"),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:g({active:l.value==="todo"}),onClick:o[2]||(o[2]=r(s=>p("todo"),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:g({active:l.value==="done"}),onClick:o[3]||(o[3]=r(s=>p("done"),["prevent"]))},"已完成",2)])]),t("div",G,[t("ul",H,[(d(!0),u(M,null,N(L.value,s=>(d(),u("li",{key:s.id},[t("label",K,[$(t("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":f=>s.status=f,onChange:f=>b(s)},null,40,Q),[[U,s.status]]),t("span",null,k(s.content),1)]),t("a",{href:"#",onClick:r(f=>z(s),["prevent"])},Y,8,W)]))),128))]),t("div",Z,[a.value.length===0?(d(),u("p",tt,"目前尚無待辦事項")):y("",!0),a.value.length>0?(d(),u("p",et,k(w.value)+" 個未完成項目",1)):y("",!0)])])])])])]))}};export{nt as default};
