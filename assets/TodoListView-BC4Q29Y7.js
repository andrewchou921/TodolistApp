import{u as S,r as d,i as B,h as u,j as p,c as g,a as o,t as T,w as h,b as w,v as E,n as m,F as M,k as N,l as y,o as k,m as O}from"./index-DSj7v7Pz.js";const U=(a,s)=>{const i=a.__vccOpts||a;for(const[e,r]of s)i[e]=r;return i};S();const v="https://todolist-api.hexschool.io",D={setup(){const a=d({nickname:"",uid:"",token:""});B(async()=>{const t=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");if(t)try{const l=await u.get(`${v}/users/checkout`,{headers:{Authorization:t}});a.value=l.data,a.value.token=t,console.log("登入成功:",a.value),f()}catch(l){console.error("用戶驗證失敗:",l),document.cookie="customTodoToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",window.location.href="/login"}else window.location.href="/login"});async function s(){try{a.value={nickname:"",uid:"",token:""},alert("您已登出"),window.location.href="/login"}catch(t){console.error("登出失敗:",t)}}const i=d([]),e=d(""),r=d("all"),c=d(null),n=d(""),_=p(()=>r.value==="todo"?i.value.filter(t=>!t.status):r.value==="done"?i.value.filter(t=>t.status):i.value),C=p(()=>i.value.filter(t=>!t.status).length),b=t=>{r.value=t};async function f(){try{const{data:t}=await u.get(`${v}/todos`,{headers:{Authorization:`${a.value.token}`}});i.value=t.data}catch(t){console.error("取得待辦事項失敗:",t)}}async function L(){var t;try{const l=e.value.trim();if(l.length===0)return alert("Todo內容不能為空白");if(!a.value.token)return alert("未獲得授權，請重新登入");await u.post(`${v}/todos`,{content:l},{headers:{Authorization:` ${a.value.token}`}}),e.value="",f()}catch(l){console.error("新增待辦事項失敗:",((t=l.response)==null?void 0:t.data)||l.message),alert("新增待辦事項失敗，請檢查輸入內容或重新登入")}}async function x(t){try{await u.patch(`${v}/todos/${t.id}/toggle`,{},{headers:{Authorization:`${a.value.token}`}}),f()}catch(l){console.error("切換狀態失敗:",l)}}async function z(t){try{await u.delete(`${v}/todos/${t.id}`,{headers:{Authorization:`${a.value.token}`}}),f()}catch(l){console.error("刪除待辦事項失敗:",l)}}function $(t){c.value=t,n.value=t.content}async function A(t){try{if(t.content===n.value){c.value=null;return}await u.put(`${v}/todos/${t.id}`,{content:n.value},{headers:{Authorization:`${a.value.token}`}}),c.value=null,f()}catch(l){console.error("保存編輯失敗:",l)}}function V(t){return c.value&&c.value.id===t.id}return{user:a,todos:i,newTodoContent:e,currentTab:r,filteredTodos:_,todoCount:C,switchTab:b,addTodo:L,toggleTodoStatus:x,deleteTodo:z,editTodoStart:$,saveEdit:A,isEditing:V,logout:s}}},P={id:"todoListPage",class:"bg-half"},F=o("h1",null,[o("a",{href:"#"},"ONLINE TODO LIST")],-1),I={class:"todo_sm"},j={href:"#"},J={class:"container todoListPage vhContainer"},R={class:"todoList_Content"},q={class:"inputBox"},G=o("i",{class:"fa fa-plus"},null,-1),H=[G],K={class:"todoList_list"},Q={class:"todoList_tab"},W={class:"todoList_items"},X={class:"todoList_item"},Y={class:"todoList_label"},Z=["onUpdate:modelValue","onChange"],tt=["onClick"],ot=o("i",{class:"fa-solid fa-trash-can fa-lg"},null,-1),et=[ot],nt={class:"todoList_statistics"},st={key:0},at={key:1};function lt(a,s,i,e,r,c){return k(),g("div",P,[o("nav",null,[F,o("ul",null,[o("li",I,[o("a",j,[o("span",null,T(e.user.nickname)+"的代辦",1)])]),o("li",null,[o("a",{href:"#loginPage",onClick:s[0]||(s[0]=h((...n)=>e.logout&&e.logout(...n),["prevent"]))},"登出")])])]),o("div",J,[o("div",R,[o("div",q,[w(o("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[1]||(s[1]=n=>e.newTodoContent=n)},null,512),[[E,e.newTodoContent]]),o("a",{href:"#",onClick:s[2]||(s[2]=h((...n)=>e.addTodo&&e.addTodo(...n),["prevent"]))},H)]),o("div",K,[o("ul",Q,[o("li",null,[o("a",{href:"#",class:m({active:e.currentTab==="all"}),onClick:s[3]||(s[3]=h(n=>e.switchTab("all"),["prevent"]))},"全部",2)]),o("li",null,[o("a",{href:"#",class:m({active:e.currentTab==="todo"}),onClick:s[4]||(s[4]=h(n=>e.switchTab("todo"),["prevent"]))},"待完成",2)]),o("li",null,[o("a",{href:"#",class:m({active:e.currentTab==="done"}),onClick:s[5]||(s[5]=h(n=>e.switchTab("done"),["prevent"]))},"已完成",2)])]),o("div",W,[o("ul",X,[(k(!0),g(M,null,N(e.filteredTodos,n=>(k(),g("li",{key:n.id},[o("label",Y,[w(o("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":_=>n.status=_,onChange:_=>e.toggleTodoStatus(n)},null,40,Z),[[O,n.status]]),o("span",null,T(n.content),1)]),o("a",{href:"#",onClick:h(_=>e.deleteTodo(n),["prevent"])},et,8,tt)]))),128))]),o("div",nt,[e.todos.length===0?(k(),g("p",st,"目前尚無待辦事項")):y("",!0),e.todos.length>0?(k(),g("p",at,T(e.todoCount)+" 個未完成項目",1)):y("",!0)])])])])])])}const rt=U(D,[["render",lt]]);export{rt as default};
